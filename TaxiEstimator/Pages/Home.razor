@page "/"
@using TaxiEstimator.Models
@using TaxiEstimator.Services
@inject FareService FareService
@inject MapboxService MapboxService
@inject IJSRuntime JS

<PageTitle>Estimator Taxi</PageTitle>

<div class="container">
    <h1>Estimator Cursă Taxi</h1>

    <div class="row mb-3">
        <div class="col">
            <label>Latitudine Plecare</label>
            <input type="number" @bind="trip.StartLat" class="form-control" step="0.0001" />
        </div>
        <div class="col">
            <label>Longitudine Plecare</label>
            <input type="number" @bind="trip.StartLng" class="form-control" step="0.0001" />
        </div>
    </div>

    <div class="row mb-3">
        <div class="col">
            <label>Latitudine Destinație</label>
            <input type="number" @bind="trip.EndLat" class="form-control" step="0.0001" />
        </div>
        <div class="col">
            <label>Longitudine Destinație</label>
            <input type="number" @bind="trip.EndLng" class="form-control" step="0.0001" />
        </div>
    </div>

    <button class="btn btn-primary" @onclick="CalculateTrip">Calculează Preț</button>

    <hr />

    @if (trip.DistanceKm > 0)
    {
        <div class="alert alert-success">
            <h4>Rezultat:</h4>
            <p><strong>Distanță:</strong> @trip.DistanceKm.ToString("F2") km</p>
            <p><strong>Durată:</strong> @trip.DurationMin.ToString("F0") minute</p>
            <p><strong>Preț Estimat:</strong> @trip.EstimatedPrice.ToString("C2") RON</p>
        </div>
    }

    <div id="map" style="height: 400px; width: 100%; margin-top: 20px;"></div>
</div>

@code {
    // Aici începe zona de C# - OBLIGATORIU între acolade
    private TripModel trip = new TripModel();

    protected override void OnInitialized()
    {
        // Inițializăm cu niște coordonate default (ex: București) ca să nu fie gol
        trip.StartLat = 44.4268;
        trip.StartLng = 26.1025;
        trip.EndLat = 44.4377;
        trip.EndLng = 26.0973;
    }

    private async Task CalculateTrip()
    {
        // 1. Apelăm Mapbox pentru distanță (Simulăm momentan)
        // În viitor aici va fi: await MapboxService.GetRouteAsync(trip);
        
        // Simulare date pentru testare:
        trip.DistanceKm = 5.5; 
        trip.DurationMin = 15;

        // 2. Calculăm prețul
        trip.EstimatedPrice = FareService.CalculatePrice(trip.DistanceKm);
    }
}